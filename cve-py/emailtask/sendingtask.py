#!/usr/bin/python
# -*- coding: UTF-8 -*-

################################################################################
#
# Copyright (c) 2020 openEuler.org, Inc. All Rights Reserved
#
################################################################################
"""
Email notification of incorrect data

Authors: xiaojianghui
Date:    10/22/2020 11:01 AM
"""

import os
from dbConnecttion import MysqlConn
from emailtask import sendemail


def sending():
    """
        Query all recipients
    """
    mysql = MysqlConn.Mysql()
    sql = "select email_name from cve_email_list where email_type=1"
    result = mysql.getMany(sql)
    mysql.close()
    print(result)
    for i in result:
        subject = "表格错误数据反馈"
        content = "提交的CVE数据出错，请检查格式及内容，详见附件"
        sendemail.send_email("smtp.gmail.com", 587,
                             os.getenv("CVE_EMAIL_SENDADDR"),
                             os.getenv("CVE_EMAIL_PASSWORD"),
                             str(i['email_name'], encoding='utf-8'), subject, content)
