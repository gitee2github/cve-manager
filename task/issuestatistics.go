package task

import (
	"cvevulner/common"
	"cvevulner/taskhandler"
	"github.com/astaxie/beego"
	"github.com/astaxie/beego/logs"
)

// issue statistics mailing list
func IssueStatistics() error {
	defer common.Catchs()
	logs.Info("issue statistics task start")
	// The number of days the issue counts the mailing list
	beforeDate, beErr := beego.AppConfig.Int("cve::cve_statistics_date")
	if beErr != nil {
		beforeDate = 20
	}
	prnum, prErr := beego.AppConfig.Int("crontab::prcnum")
	if prErr != nil {
		prnum = 100
	}
	owner := beego.AppConfig.String("gitee::owner")
	// Get the data source of the table
	err := taskhandler.IssueStatistics(beforeDate, prnum, owner)
	logs.Info(err)
	logs.Info("issue statistics task end")
	return err
}

// Cve data email task with low credibility
func ProcCveLowCred() error {
	defer common.Catchs()
	logs.Info("cve credibility task start")
	// The number of days the issue counts the mailing list
	beforeDate, beErr := beego.AppConfig.Int("cve::cve_statistics_date")
	if beErr != nil {
		beforeDate = 30
	}
	prnum, prErr := beego.AppConfig.Int("crontab::prcnum")
	if prErr != nil {
		prnum = 100
	}
	// Get the data source of the table
	err := taskhandler.CveCredibilityStatistics(beforeDate, prnum)
	logs.Info(err)
	logs.Info("cve credibility task end")
	return err
}
