#!/usr/bin/python
# -*- coding: UTF-8 -*-

################################################################################
#
# Copyright (c) 2020 openEuler.org, Inc. All Rights Reserved
#
################################################################################
"""

1. Process manual excel data;
2. Crawling the maintainer of the warehouse;
3. Initialize the database file;

Authors: xiaojianghui
Date:    10/22/2020 11:01 AM
"""
import flask
from flask import request
from controller import timertaskcontroller
from tabletask import supplement_cve
from gevent import pywsgi

app = flask.Flask(__name__)


@app.route('/pulls/cve/info', methods=['post'])
def pull_cve_info():
    cve_num = str(request.json.get("CveNum")).strip()
    supplement_cve.pull_cve(cve_num)
    if len(cve_num) > 0:
        return {
            "code": 200,
            "message": "success"
        }
    else:
        return {
            "code": 404,
            "message": "Parameter error"
        }


if __name__ == '__main__':
    print("Start a scheduled task...")
    timertaskcontroller.timertask()
    server = pywsgi.WSGIServer(('0.0.0.0', 8080), app)
    server.serve_forever()
