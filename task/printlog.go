package task

import (
	"errors"
	"fmt"
	"github.com/astaxie/beego/config"
	"github.com/astaxie/beego/logs"
	"io/ioutil"
	"os"
)

func DeletLogs() error{
	BConfig, err := config.NewConfig("ini", "conf/app.conf")
	if err != nil{
		logs.Error("config init error:", err)
		return err
	}
	logDir := BConfig.String("log::log_dir")
	if logDir == ""{
		logs.Error("config excel::log_dir error: invalid value is ", logDir)
		return errors.New("value is nil")
	}
	fileInfoList, err := ioutil.ReadDir(logDir)
	if err != nil {
		logs.Error(err)
		return err
	}
	fmt.Println(len(fileInfoList))
	for i := range fileInfoList {
		if fileInfoList[i].Name() != "cve.log" {
			err := os.Remove(logDir + "/" + fileInfoList[i].Name())
			if err != nil {
				logs.Error("删除文件失败: ", fileInfoList[i].Name())
			}
		}
	}
	return nil
}
//ProcCveOriginData 处理api获取的原始数据
func ProcLogData() error{
	// delete logs
	err := DeletLogs()
	if err != nil {
		logs.Error(err)
	}

	// 打印日志
	return err
}

