FROM centos:latest

MAINTAINER TommyLike<tommylikehu@gmail.com>

FROM library/golang

# Godep for vendoring
RUN go get github.com/tools/godep

# Recompile the standard library without CGO
RUN CGO_ENABLED=0 go install -a std

ENV APP_DIR $GOPATH\src\cve-manager
RUN mkdir -p $APP_DIR

# Set the entrypoint
ENTRYPOINT (cd $APP_DIR && ./\src\cve-manager)
ADD . $APP_DIR

# Compile the binary and statically link
#RUN cd $APP_DIR && CGO_ENABLED=0 godep go build -ldflags '-d -w -s'

EXPOSE 80

# copy binary config and utils
FROM golang:latest
RUN  mkdir -p /opt/cve-manager/conf
COPY ./conf/product_app.conf /opt/cve-manager/app.conf
COPY  ./cve-manager/cve-manager /opt/cve-manager

WORKDIR /opt/app/
ENTRYPOINT ["/opt/app/cve-manager"]