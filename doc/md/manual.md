## issue分析说明

### issue分析触发流程图
<img src="../image/触发issue流程图.png" />

#### issue 分析评论流程
 
issue分析注意事项
- 所有人都可以在评论区对issue进行分析，由Maintainer进行审核或修改
- 分析issue模板并拷贝以下内容在**评论区回复**： 
  ```batch
    影响性分析说明:  
    openEuler评分: (评分和向量)
    受影响版本排查(受影响/不受影响): 
    1.openEuler-20.03-LTS:
    2.openEuler-20.09:
  ```
- 受影响版本排查(受影响/不受影响)填写说明：
   ```batch
    1>issue模板或第一条评论中不包含 如：1.openEuler-20.03-LTS:之类的填写项则不需要填写，
      如Maintainer发现有对应的版本需要填写则参考下方说明格式填写
    2>填写方式： 
       1.openEuler-20.03-LTS:受影响
       2.openEuler-20.09:不受影响
  ```
 - 分析内容可一次性填写完整也可分条填写
 - 重复分析内容可覆盖上一次分析的内容（只要包含键值的评论不管内容是否为空都会覆盖）
 - cve-manage 在每次分析评论提交后根据内容进行解析并根据解析后的内容进行回复，Maintainer在评论后没得到回复可主动刷新页面或有延迟
 - 当内容填写完整会触发两种回复中的一种：
 
    1.评分不一致需要审核
    
    | 状态  | 需分析            | 内容                     |
    |-----|----------------|------------------------|
    | 已分析 | openEulerScore | 6.0                    |
    | 已分析 | 影响性分析说明        | 您分析的内容                 |
    | 已分析 | openEulerVector | AV:A/AC:C...           |
    | 已分析 | 受影响的版本         | openEuler-20.03-LTS:受影响 |
     **因openEulerScore与NvdScore不一致，分析内容需审核，请等待审核** 
     
     2.评分一致
     
     | 状态  | 需分析            | 内容                     |
     |-----|----------------|------------------------|
     | 已分析 | openEulerScore | 6.0                    |
     | 已分析 | 影响性分析说明        | 您分析的内容                 |
     | 已分析 | openEulerVector | AV:A/AC:C...           |
     | 已分析 | 受影响的版本         | openEuler-20.03-LTS:受影响 |
     **请确认分析内容的准确性，确认无误后，您可以进行后续步骤或您可以继续分析。** 
  - 评分不一致则需等待审核员审核后进行下一步 **否则将视为无效分析将不可导出**
  - issue 已完成（关闭）且已分析完结、评分不一致需审核通过后的issue才具备发布安全公告到官网
  
 ### 审核员操作说明
   - 安全委员会成员对填写的评分在当前issue的评论区回复如下指令
   - 使用指令说明
   
        | 指令 | 指令说明 | 使用权限 |
        | ------ | ------- | ------- |
        | /approve | 审核通过 | security-committee-sig组成员 |
        | /reject | 审核拒绝 | security-committee-sig组成员 |
        | /close | 关闭issue | issue 管理员 |
   
   - 注意事项
   ```batch
    1.指令独占一行
    2.以最后一位审核员评论审核的指令为最终指令
    3.审核评论成功 cve-manage 会新增一条@责任人的评论
      （若没有新增评论，可主动刷新页面，多次刷新后没有回复则没有审核评论成功）
    4.对于‘/close’ 指令有两种含义
      4.1 正常关闭issue 所有流程走完要关闭issue(如分析流程没走完系统将默认为异常关闭)，可以使用该指令也可以使用gitee提供的操作界面修改issue状态。
      4.2 异常关闭issue 如发现该issue因某种原因不需要分析，则可以使用该指令关闭issue并可携带关闭原因。
          例：/close 该CVE内容不符合事实 
          (ps 关闭原因cvemanage将记录到数据库并作为反馈给cve提供方，异常原因可选不影响issue的关闭。 
           异常关闭建议最好加上异常关闭原因同时建议使用指令而不是使用giee界面操作。)
```
 ### issue关闭前审核说明
   - Maintainer需要审核模板内容是否填写正确，在当前issue的评论区回复如下指令
   - 使用指令说明

       | 指令 | 指令说明 | 使用权限 |
       | ------ | ------- | ------- |
       | /approve | 审核通过 | issue 负责人 |
       
   - 当前issue没有受影响的分支时，需要安全委员会人员进行审核
   - 使用指令说明
   
      | 指令 | 指令说明 | 使用权限 |
      | ------ | ------- | ------- |
      | /approve | 审核通过 | security-committee-sig组成员 |
      | /reject | 审核拒绝 | security-committee-sig组成员 |
      
      
### 数据导出
#### 1.调用数据导出接口，触发生成excel的任务
 - 接口说明：
 
| 说明 | 内容 |
| --- | ---- |
| 请求地址 | https://api.openeuler.org/cve-manager/v1/download/excel/triggerCveData |
| 请求类型 | GET |
- 参数：

| 参数 | 是否必传 | 类型 | 数据类型 | 参数说明 |
| --- | --- | --- | --- | --- |
| startTime | yes | query | string | PR 合并的有效时间起始值 |   

- 响应返回：
 ```batch
返回本次调用生成的excel文件名和fileCode 
fileCode 用与下载本次调用生成的Excel文档
```
#### 2.下载cve与安全公告excel文档
 - 接口说明：
 
| 说明 | 内容 |
| --- | ---- |
| 请求地址 | https://api.openeuler.org/cve-manager/v1/download/excel/downloadExcel |
| 请求类型 | GET |
- 参数：

| 参数 | 是否必传 | 类型 | 数据类型 | 参数说明 |
| --- | --- | --- | --- | --- |
| fileCode | yes | query | string | 数据导出接口返回的fileCode |   

- 响应返回：
  - 文件正在生成中： The file is being generated, please try again later!
  - 文件生成完成 ： 返回excel文档
  - 文件生成失败： File generation failed, please contact the administrator or regenerate!


    
